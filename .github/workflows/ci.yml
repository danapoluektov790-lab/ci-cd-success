name: CI/CD Success Pipeline

on: 
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  setup-project:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ—‚ï¸ Create Python project
      run: |
        echo "Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°..."
        mkdir -p src tests
        
        # Calculator class
        cat > src/calculator.py << 'EOF'
class Calculator:
    def add(self, a, b):
        return a + b
        
    def subtract(self, a, b):
        return a - b
        
    def multiply(self, a, b):
        return a * b
        
    def divide(self, a, b):
        if b == 0:
            raise ValueError("Cannot divide by zero")
        return a / b
EOF

        # Tests
        cat > tests/test_calculator.py << 'EOF'
import sys
import os
sys.path.append(os.path.join(os.path.dirname(__file__), '..'))

from src.calculator import Calculator

def test_add():
    calc = Calculator()
    assert calc.add(2, 3) == 5

def test_subtract():
    calc = Calculator()
    assert calc.subtract(5, 3) == 2

def test_multiply():
    calc = Calculator()
    assert calc.multiply(3, 4) == 12

def test_divide():
    calc = Calculator()
    assert calc.divide(6, 3) == 2

def test_divide_by_zero():
    calc = Calculator()
    try:
        calc.divide(5, 0)
        assert False
    except ValueError:
        assert True
EOF

        # Requirements
        echo "pytest" > requirements.txt
        
        echo "âœ… ĞŸÑ€Ğ¾ĞµĞºÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½!"

  run-tests:
    runs-on: ubuntu-latest
    needs: setup-project
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"
        
    - name: ğŸ“¦ Install dependencies
      run: |
        pip install -r requirements.txt
        echo "âœ… Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹"
        
    - name: ğŸ§ª Run tests
      run: |
        echo "Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ñ‚ĞµÑÑ‚Ñ‹..."
        python -c "from src.calculator import Calculator; print('âœ… Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚')"
        pytest tests/ -v
        echo "âœ… Ğ’ÑĞµ Ñ‚ĞµÑÑ‚Ñ‹ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¸!"

  quality-checks:
    runs-on: ubuntu-latest
    needs: run-tests
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ” Code quality
      run: |
        echo "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ĞºĞ¾Ğ´Ğ°..."
        python -m py_compile src/calculator.py
        python -m py_compile tests/test_calculator.py
        echo "âœ… ĞšĞ¾Ğ´ ĞºĞ¾Ğ¼Ğ¿Ğ¸Ğ»Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ±ĞµĞ· Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº"
        
    - name: ğŸ“Š Results
      run: |
        echo " "
        echo "ğŸ‰ğŸ‰ğŸ‰ CI/CD PIPELINE Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞ Ğ’Ğ«ĞŸĞĞ›ĞĞ•Ğ! ğŸ‰ğŸ‰ğŸ‰"
        echo " "
        echo "âœ… ĞŸÑ€Ğ¾ĞµĞºÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸"
        echo "âœ… Ğ¢ĞµÑÑ‚Ñ‹ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾"
        echo "âœ… ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ĞºĞ¾Ğ´Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¾"
        echo "âœ… GitHub Actions Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚!"
        echo " "
        echo "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:"
        echo "ğŸ“ src/calculator.py"
        echo "ğŸ“ tests/test_calculator.py" 
        echo "ğŸ“„ requirements.txt"
        echo " "
